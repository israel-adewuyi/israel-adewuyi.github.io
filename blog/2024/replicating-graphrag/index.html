<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Replicating GraphRAG paper | Israel Adewuyi</title>
    <meta name="author" content="Israel Adewuyi" />
    <meta
      name="description"
      content="this blog details my attempt at replicating the graphrag paper as well as the decisions I made."
    />
    <meta name="keywords" content="LLM, RAG, graphrag" />
    <link
      rel="stylesheet"
      href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css"
      integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw="
      crossorigin="anonymous"
    />
    <link
      defer
      rel="stylesheet"
      href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"
    />
    <link
      defer
      rel="stylesheet"
      type="text/css"
      href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"
    />
    <link
      defer
      rel="stylesheet"
      href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99"
      media=""
      id="highlight_theme_light"
    />
    <link
      rel="shortcut icon"
      href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"
    />
    <link
      rel="stylesheet"
      href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"
    />
    <link
      rel="canonical"
      href="https://israel-adewuyi.github.io/blog/2021/distill/"
    />
    <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script>
    <link
      defer
      rel="stylesheet"
      href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca"
      media="none"
      id="highlight_theme_dark"
    />
    <script>
      initTheme();
    </script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js"
      integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc="
      crossorigin="anonymous"
    ></script>
    <script
      defer
      src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"
      integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
      crossorigin="anonymous"
    ></script>
    <script type="text/javascript">
      window.MathJax = { tex: { tags: "ams" } };
    </script>
    <script
      defer
      type="text/javascript"
      id="MathJax-script"
      src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js"
      integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="
      crossorigin="anonymous"
    ></script>
    <script
      defer
      src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"
      crossorigin="anonymous"
    ></script>
    <script src="/assets/js/distillpub/template.v2.js"></script>
    <script src="/assets/js/distillpub/transforms.v2.js"></script>
    <script src="/assets/js/distillpub/overrides.js"></script>
    <style type="text/css">
      .fake-img {
        background: #bbb;
        border: 1px solid rgba(0, 0, 0, 0.1);
        box-shadow: 0 0 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 12px;
      }
      .fake-img p {
        font-family: monospace;
        color: white;
        text-align: left;
        margin: 12px 0;
        text-align: center;
        font-size: 16px;
      }
    </style>
  </head>
  <body>
    <d-front-matter>
      <script async type="text/json">
        {
          "title": "Replicating GraphRAG paper",
          "description": "a replication of 'From Local to Global'",
          "published": "November 8, 2024",
          "authors": [
            {
              "author": "Israel Adewuyi",
              "authorURL": "https://israel-adewuyi.github.io/",
              "affiliations": [
                {
                  "name": "Innopolis University",
                  "url": "https://innopolis.university/"
                }
              ]
            }
          ],
          "katex": {
            "delimiters": [
              {
                "left": "$",
                "right": "$",
                "display": false
              },
              {
                "left": "$$",
                "right": "$$",
                "display": true
              }
            ]
          }
        }
      </script>
    </d-front-matter>
    <header>
      <nav
        id="navbar"
        class="navbar navbar-light navbar-expand-sm fixed-top"
        role="navigation"
      >
        <div class="container">
          <a class="navbar-brand title font-weight-lighter" href="/">
            <span class="font-weight-bold">Israel</span> Adewuyi
          </a>
          <button
            class="navbar-toggler collapsed ml-auto"
            type="button"
            data-toggle="collapse"
            data-target="#navbarNav"
            aria-controls="navbarNav"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar top-bar"></span>
            <span class="icon-bar middle-bar"></span>
            <span class="icon-bar bottom-bar"></span>
          </button>
          <div class="collapse navbar-collapse text-right" id="navbarNav">
            <ul class="navbar-nav ml-auto flex-nowrap">
              <li class="nav-item"><a class="nav-link" href="/">About </a></li>
              <li class="nav-item active">
                <a class="nav-link" href="/blog/"
                  >nanotransformer-circuits
                  <span class="sr-only">(current)</span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/publications/">publications </a>
              </li>
              <!-- <li class="nav-item">
                <a class="nav-link" href="/projects/">projects </a>
              </li> -->
              <!-- <li class="nav-item">
                <a class="nav-link" href="/repositories/">repositories </a>
              </li> -->
              <!-- <li class="nav-item"><a class="nav-link" href="/cv/">cv </a></li> -->
              <!-- <li class="nav-item">
                <a class="nav-link" href="/teaching/">teaching </a>
              </li> -->
              <!-- <li class="nav-item">
                <a class="nav-link" href="/people/">people </a>
              </li> -->
              <!-- <li class="nav-item dropdown active">
                <a
                  class="nav-link dropdown-toggle"
                  href="#"
                  id="navbarDropdown"
                  role="button"
                  data-toggle="dropdown"
                  aria-haspopup="true"
                  aria-expanded="false"
                  >submenus <span class="sr-only">(current)</span>
                </a>
                <div
                  class="dropdown-menu dropdown-menu-right"
                  aria-labelledby="navbarDropdown"
                >
                  <a class="dropdown-item" href="/publications/"
                    >publications</a
                  >
                  <div class="dropdown-divider"></div>
                  <a class="dropdown-item" href="/projects/">projects</a>
                  <div class="dropdown-divider"></div>
                  <a class="dropdown-item active" href="/blog/">blog</a>
                </div>
              </li> -->
              <!-- <li class="nav-item">
                <button
                  id="search-toggle"
                  title="Search"
                  onclick="openSearchModal()"
                >
                  <span class="nav-link"
                    >ctrl k <i class="ti ti-search"></i
                  ></span>
                </button>
              </li> -->
              <li class="toggle-container">
                <button id="light-toggle" title="Change theme">
                  <i class="ti ti-sun-moon" id="light-toggle-system"></i>
                  <i class="ti ti-moon-filled" id="light-toggle-dark"></i>
                  <i class="ti ti-sun-filled" id="light-toggle-light"></i>
                </button>
              </li>
            </ul>
          </div>
        </div>
      </nav>
      <progress id="progress" value="0">
        <div class="progress-container"><span class="progress-bar"></span></div>
      </progress>
    </header>
    <div class="post distill">
      <d-title>
        <h1>Replicating GraphRAG paper</h1>
        <p>a replication of 'From Local to Global'</p>
      </d-title>
      <d-byline></d-byline>
      <d-article>
        <d-contents>
          <nav class="l-text figcaption">
            <h3>Contents</h3>
            <div><a href="#background">Background</a></div>
            <div><a href="#summary">Summary</a></div>
            <div><a href="#chunks">Text Chunking</a></div>
            <div><a href="#entities">Entity extraction</a></div>
            <div><a href="#clustering">Graph clustering</a></div>
            <div><a href="#community">Community summary</a></div>
            <div><a href="#query">How are queries answered?</a></div>
            <div><a href="#discussion">Discussion</a></div>
            <div><a href="#Acknowledgements">Acknowledgements</a></div>
            <!-- <div><a href="#footnotes">Code Blocks</a></div>
            <div><a href="#interactive-plots">Interactive Plots</a></div>
            <div><a href="#layouts">Layouts</a></div>
            <div><a href="#other-typography">Other Typography?</a></div> -->
          </nav>
        </d-contents>
        <h2 id="background">Background</h2>
        <p>
          This blog represents my attempt at replicating, understanding the
          limitations of GraphRAG
          <d-cite key="edge2024localglobalgraphrag"></d-cite> approach to
          retrieval with LLMs and thinking about tradeoffs to be made when
          working with retrieval systems in general. The major considerations
          were surrounding the number of api calls for a single user query and
          the speed of retrieval.
        </p>
        <p>
          It was also an opportunity to upskill as a research engineer and
          explore different tools to get the job done as fast as possible, as
          efficient as possible.
        </p>
        <p>
          I would expect readers to be fairly familiar with the GraphRAG paper
          <d-cite key="edge2024localglobalgraphrag"></d-cite>.
        </p>

        <h2 id="summary">Summary</h2>
        <ul>
          <li>
            For evaluation, I used one of the transcripts of
            <a href="https://www.youtube.com/watch?v=UTuuTTnjxMQ"
              >Dwarkesh Patel's podcast</a
            >
            as the knowledge source.
          </li>
          <li>Chunking was primarily based on conversation turn.</li>
          <li>
            During development, I used a bunch of models to test out the
            different components, but for the final graph index generation and
            inference, I used
            <a href="https://console.groq.com/settings/limits"
              >LLAMA 3.2 90B text-preview</a
            ><d-cite key="llama3_2"></d-cite>, provided by
            <a href="https://console.groq.com/playground">Groq</a>.
          </li>
          <li>
            I implemented a single hierarchy of clustering graph nodes and
            edges.
          </li>
          <li>
            For the sake of optimizing for API the number of calls / requests to
            <a href="https://console.groq.com/playground">Groq</a>, I
            implemented global search with a vectorDB, as opposed to LLM
            summarization in the graphrag paper.
            <d-cite key="edge2024localglobalgraphrag"></d-cite>
          </li>
          <li>
            I did not implement
            <a href="https://microsoft.github.io/graphrag/query/local_search/"
              >local search</a
            >, covariates and a couple of other details that were token/api
            calls-expensive.
          </li>
          <li>
            LLM-derived Knowledge graph can be viewed
            <a href="/assets/html/network.html">here</a>
          </li>
          <li>
            <a href="https://github.com/israel-adewuyi/graphrag"
              >Link to repository</a
            >,
            <a href="https://graphrag-impl.streamlit.app/"
              >Link to streamlit chat interface</a
            ><d-footnote
              >I did not exactly optimise the chat interface to be a
              conversational agent like SOTA chat agents. Ask questions, get a
              response.
            </d-footnote>
          </li>
        </ul>
        <h2 id="chunks">Text Chunking</h2>
        <p>
          I thought to take advantage of the structure of podcase transcripts,
          which is usually turn based.
          <details>
            <summary>More info</summary>
            <p>
              Usually, podcast transcripts are roughly structured as
              <figure class="highlight">
                <pre><code class="language-python" data-lang="python"><span class="kn">Speaker A (timestamp)</span> 
<span class="kn"># Speaker A's speech</span>
<span class="kn">Speaker B (timestamp)</span> 
<span class="kn"># Speaker B's speech</span>
              </code></pre>
              </figure>
            </p>
          </details>
          The reasoning behind this was that it's much easier to make sense of a
          body of text that's from a speaker in a single turn, from start to
          finish, than a text consisting of the second half of a speech, for
          example, which might be the case with arbitrary chunking.
        </p>
        <p>
          I scraped the
          <a
            href="https://www.dwarkeshpatel.com/p/sholto-douglas-trenton-bricken?open=false#%C2%A7transcript"
            >transcripts</a
          >
          webpage and initially, I split the whole document along each speaker's
          speech, which resulted in approximately 483 chunks. I analyzed the
          token length of each chunk.
          <img
            src="/assets/img/graphrag/Sholto&Trenton.png"
            class="img-fluid rounded z-depth-1"
            width="100%"
            height="auto"
            loading="eager"
            onerror="this.onerror=null; $('.responsive-img-srcset').remove();"
            alt="Token distribution for chunks in the original chunk set"
          />
        </p>

        <ol>
          <li>
            This would mean that for only entity extraction with multiple rounds
            of gleaning, there would be multiple API calls for each chunk, which
            is expensive and not very efficient.
          </li>
          <li>
            In the graphrag paper
            <d-cite key="edge2024localglobalgraphrag"></d-cite>, the number of
            chunk tokens used was
            <code class="language-plaintext">600</code> tokens.
          </li>
        </ol>
        <p>
          I <strong>used</strong> an average chunk size of 1000 tokens. This
          reduced the number of chunks from
          <code class="language-plaintext">483</code> to
          <code class="language-plaintext">47</code>.
          <img
            src="/assets/img/graphrag/Sholto&Trenton_merged.png"
            class="img-fluid rounded z-depth-1"
            width="100%"
            height="auto"
            loading="eager"
            onerror="this.onerror=null; $('.responsive-img-srcset').remove();"
            alt="Token distribution for chunks in the original chunk set"
          />
        </p>
        <h2 id="entities">Entity extraction</h2>

        <p>
          For each chunk, extracting the entity types before extracting the
          entity details and the relationship details was token-expensive. So I
          hardcoded a bunch of entity types and manually asked ChatGPT to
          extract entity types from some random sample of chunks. I ended up
          with about
          <a
            href="https://github.com/israel-adewuyi/graphrag/blob/master/config/entities.py"
            >33 entity types.</a
          >It's unsure the relationship between the number of entity types and
          how much information is extracted from the chunks.
        </p>
        <p>
          For each chunk from the previous section, I prompted the LLM to
          extract all the entities and the relationship between them. I also did
          a single round of gleaning for each chunk to ensure that all the
          entities and relationship have been extracted.
          <d-footnote
            >The prompts I used here and other parts of the implementation were
            largely taken from
            <a
              href="https://github.com/microsoft/graphrag/tree/main/graphrag/prompt_tune/template"
              >the official github implementation.</a
            >
          </d-footnote>
        </p>
        <p>
          A <a href="/assets/html/network.html">knowledge graph</a> is then
          built from the entities and their relationships that have been
          extracted. I used the
          <a href="https://networkx.org/documentation/stable/index.html"
            >NetworkX</a
          >
          library to construct the network graph.<d-cite
            key="trajanoska2023enhancingknowledgegraphconstruction"
          ></d-cite>
          <d-cite key="SciPyProceedings_11"></d-cite>
        </p>
        <p>
          <!-- TODO: mention this in thoughts
                      note the usage of entity and relationship which guides the blog 
          -->
          A problem here which can be observed from the
          <a href="/assets/html/network.html">knowledge graph</a> is that there
          are a bunch of entities that are not captured in any relatioship with
          another entity.
        </p>
        <h2 id="clustering">Graph clustering</h2>
        <p>
          In following with the original paper, I used the Leiden algorithm
          <d-cite key="traag2019louvain"></d-cite> provided in
          <a href="https://cdlib.readthedocs.io/en/latest/">cdlib library</a> to
          cluster the graph into communities and I did the graph clustering for
          a single hierarchy level.
          <!-- TODO:  if I can build graph from communities -->
          <img
            src="/assets/img/graphrag/graph_community.png"
            class="img-fluid rounded z-depth-1"
            width="70%"
            height="auto"
            loading="eager"
            onerror="this.onerror=null; $('.responsive-img-srcset').remove();"
            alt="Token distribution for chunks in the original chunk set"
          />
        </p>

        <h2 id="community">Community summary</h2>
        <p>
          My implementation here highly differs from the original
          implementation. To understand the decision I made, let's delve into
          what happens when there is a global search on a query.
        </p>
        <p>
          In the original implementation of global search, when there is a
          query, an LLM is used to generate intermediate answer and a relevancy
          score to this query,for <strong>each</strong> community summary. Now,
          this is alot of API calls!!.
          <d-footnote
            >See <a href="https://console.groq.com/settings/limits">here</a> for
            the rate limits on requests and tokens per day</d-footnote
          >
        </p>
        <p>
          A neat thing I thought to do, was to generate a list of conclusions or
          mini-summaries for each community cluster. So instead of just a single
          community summary, there are a list of insights and conclusions for
          each community that are generated after the clustering process.
        </p>
        <p>
          These conclusions are indexed in a
          <a
            href="https://python.langchain.com/api_reference/community/vectorstores/langchain_community.vectorstores.faiss.FAISS.html"
            >vectorDB</a
          >.
        </p>
        <h2 id="query">How are queries answered?</h2>
        <p>
          For each query, I run a similarity search with all vectors in the
          vectorDB from the previous section and I return 15 vectors,<d-footnote
            >The choice here is arbitrary. A more principled way would have been
            to use some threshold similarity score or keep adding retrieved docs
            to the prompt till it exceeds context length or number of tokens per
            query.</d-footnote
          >
          along with their similarity scores. These conclusions, their scores
          and the original query are then fed into the LLM for a synthesized
          respnse.
        </p>
        <p>
          To also be efficient with tokens, I also implemented caching
          responses. This means that if a query is sent and at some time later,
          a similar query is sent
          <d-footnote>or the system deems similar</d-footnote>, it returns the
          previous results. You could imagine in a large scale system where
          there is the potential to have a lot of duplicate queries and being
          able to save resources.
        </p>
        <p>I did not implement conversation history.</p>

        <h2 id="discussion">Discussion / Final thoughts</h2>
        <ol>
          <li>
            As mentioned in <a href="#entities">this discussion</a> , there were
            some entities without relationships with other entities in the
            <a href="/assets/html/network.html">knowledge graph</a>. My
            thoughts, supported by the paper is that it would be possible to
            extract more relationships and also entities by running more rounds
            of gleaning.
          </li>
          <li>
            The quality of the generations, from the knowledge graph to the
            query response would probably be better with more advanced models
            like GPT 4o.
          </li>
          <li>
            The approach of drawing insights from communities and using these
            insights to generate response would add alot of latency to the
            retrival process when this is over huge datasets, such as the whole
            set of all Dwarkesh's podcasts
            <d-footnote
              >I plan to work on this sometime in the near future</d-footnote
            >. The rationale is, similarity search is over pieces of text which
            are way smaller than chunks, but for each chunk, there are 5 - 20
            such texts.
          </li>
          <li>
            Gleaning was able to capture significantly more relationships, but
            more entities were also introduced to the knowledge graph. I expect
            that with more rounds of gleaning, this should be resolved neatly.
            However, it's unclear if more rounds of gleaning will be supported
            by the context length of the model.
          </li>
        </ol>
        <h2 id="Acknowledgements">Acknowledgements</h2>
        <ol>
          <li>
            <strong>Professor Rustam Lukmanov</strong> for suggesting the
            project in the first place.
          </li>
          <li>
            <a href="http://kimfom.space">Kim Fom</a> for useful feedback on
            writing good code.
          </li>
        </ol>
      </d-article>
      <d-appendix>
        <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list>
      </d-appendix>
      <d-bibliography src="/assets/bibliography/graphrag.bib"></d-bibliography>
      <div id="giscus_thread" style="max-width: 930px; margin: 0 auto">
        <script>
          let giscusTheme = determineComputedTheme(),
            giscusAttributes = {
              src: "https://giscus.app/client.js",
              "data-repo": "israel-adewuyi/israel-adewuyi.github.io",
              "data-repo-id": "",
              "data-category": "Comments",
              "data-category-id": "",
              "data-mapping": "title",
              "data-strict": "1",
              "data-reactions-enabled": "1",
              "data-emit-metadata": "0",
              "data-input-position": "bottom",
              "data-theme": giscusTheme,
              "data-lang": "en",
              crossorigin: "anonymous",
              async: "",
            },
            giscusScript = document.createElement("script");
          Object.entries(giscusAttributes).forEach(([t, e]) =>
            giscusScript.setAttribute(t, e)
          ),
            document.getElementById("giscus_thread").appendChild(giscusScript);
        </script>
        <noscript
          >Please enable JavaScript to view the
          <a
            href="http://giscus.app/?ref_noscript"
            rel="external nofollow noopener"
            target="_blank"
            >comments powered by giscus.</a
          >
        </noscript>
      </div>
    </div>
    <footer class="fixed-bottom" role="contentinfo">
      <div class="container mt-0">
        © Copyright 2024 Israel Adewuyi. Powered by
        <a
          href="https://jekyllrb.com/"
          target="_blank"
          rel="external nofollow noopener"
          >Jekyll</a
        >
        with
        <a
          href="https://github.com/alshedivat/al-folio"
          rel="external nofollow noopener"
          target="_blank"
          >al-folio</a
        >
        theme. Hosted by
        <a
          href="https://pages.github.com/"
          target="_blank"
          rel="external nofollow noopener"
          >GitHub Pages</a
        >. Photos from
        <a
          href="https://unsplash.com"
          target="_blank"
          rel="external nofollow noopener"
          >Unsplash</a
        >.
      </div>
    </footer>
    <script src="/assets/js/bootstrap.bundle.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js"
      integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA="
      crossorigin="anonymous"
    ></script>
    <script type="text/javascript">
      function progressBarSetup() {
        "max" in document.createElement("progress")
          ? (initializeProgressElement(),
            $(document).on("scroll", function () {
              progressBar.attr({ value: getCurrentScrollPosition() });
            }),
            $(window).on("resize", initializeProgressElement))
          : (resizeProgressBar(),
            $(document).on("scroll", resizeProgressBar),
            $(window).on("resize", resizeProgressBar));
      }
      function getCurrentScrollPosition() {
        return $(window).scrollTop();
      }
      function initializeProgressElement() {
        let e = $("#navbar").outerHeight(!0);
        $("body").css({ "padding-top": e }),
          $("progress-container").css({ "padding-top": e }),
          progressBar.css({ top: e }),
          progressBar.attr({
            max: getDistanceToScroll(),
            value: getCurrentScrollPosition(),
          });
      }
      function getDistanceToScroll() {
        return $(document).height() - $(window).height();
      }
      function resizeProgressBar() {
        progressBar.css({ width: getWidthPercentage() + "%" });
      }
      function getWidthPercentage() {
        return (getCurrentScrollPosition() / getDistanceToScroll()) * 100;
      }
      const progressBar = $("#progress");
      window.onload = function () {
        setTimeout(progressBarSetup, 50);
      };
    </script>
    <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script>
    <script>
      addBackToTop();
    </script>
    <script
      type="module"
      src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"
    ></script>
    <ninja-keys
      hidebreadcrumbs
      noautoloadmdicons
      placeholder="Type to start searching"
    ></ninja-keys>
    <script>
      let searchTheme = determineComputedTheme();
      const ninjaKeys = document.querySelector("ninja-keys");
      "dark" === searchTheme
        ? ninjaKeys.classList.add("dark")
        : ninjaKeys.classList.remove("dark");
      const openSearchModal = () => {
        const e = $("#navbarNav");
        e.hasClass("show") && e.collapse("hide"), ninjaKeys.open();
      };
    </script>
    <script>
      const ninja = document.querySelector("ninja-keys");
      ninja.data = [
        {
          id: "nav-about",
          title: "about",
          section: "Navigation",
          handler: () => {
            window.location.href = "/";
          },
        },
        {
          id: "nav-blog",
          title: "blog",
          description: "",
          section: "Navigation",
          handler: () => {
            window.location.href = "/blog/";
          },
        },
        {
          id: "nav-publications",
          title: "publications",
          description:
            "publications by categories in reversed chronological order. generated by jekyll-scholar.",
          section: "Navigation",
          handler: () => {
            window.location.href = "/publications/";
          },
        },
        {
          id: "nav-projects",
          title: "projects",
          description: "A growing collection of your cool projects.",
          section: "Navigation",
          handler: () => {
            window.location.href = "/projects/";
          },
        },
        {
          id: "nav-repositories",
          title: "repositories",
          description:
            "Edit the `_data/repositories.yml` and change the `github_users` and `github_repos` lists to include your own GitHub profile and repositories.",
          section: "Navigation",
          handler: () => {
            window.location.href = "/repositories/";
          },
        },
        {
          id: "nav-cv",
          title: "cv",
          description:
            "This is a description of the page. You can modify it in '_pages/cv.md'. You can also change or remove the top pdf download button.",
          section: "Navigation",
          handler: () => {
            window.location.href = "/cv/";
          },
        },
        {
          id: "nav-teaching",
          title: "teaching",
          description:
            "Materials for courses you taught. Replace this text with your description.",
          section: "Navigation",
          handler: () => {
            window.location.href = "/teaching/";
          },
        },
        {
          id: "nav-people",
          title: "people",
          description: "members of the lab or group",
          section: "Navigation",
          handler: () => {
            window.location.href = "/people/";
          },
        },
        {
          id: "dropdown-publications",
          title: "publications",
          description: "",
          section: "Dropdown",
          handler: () => {
            window.location.href = "";
          },
        },
        {
          id: "dropdown-projects",
          title: "projects",
          description: "",
          section: "Dropdown",
          handler: () => {
            window.location.href = "";
          },
        },
        {
          id: "dropdown-blog",
          title: "blog",
          description: "",
          section: "Dropdown",
          handler: () => {
            window.location.href = "/blog/";
          },
        },
        {
          id: "post-google-gemini-updates-flash-1-5-gemma-2-and-project-astra",
          title:
            'Google Gemini updates: Flash 1.5, Gemma 2 and Project Astra <svg width="1.2rem" height="1.2rem" top=".5rem" viewbox="0 0 40 40" xmlns="http://www.w3.org/2000/svg"><path d="M17 13.5v6H5v-12h6m3-3h6v6m0-6-9 9" class="icon_svg-stroke" stroke="#999" stroke-width="1.5" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg>',
          description:
            "We\u2019re sharing updates across our Gemini family of models and a glimpse of Project Astra, our vision for the future of AI assistants.",
          section: "Posts",
          handler: () => {
            window.open(
              "https://blog.google/technology/ai/google-gemini-update-flash-ai-assistant-io-2024/",
              "_blank"
            );
          },
        },
        {
          id: "post-a-post-with-tabs",
          title: "a post with tabs",
          description: "this is what included tabs in a post could look like",
          section: "Posts",
          handler: () => {
            window.location.href = "/blog/2024/tabs/";
          },
        },
        {
          id: "post-a-post-with-typograms",
          title: "a post with typograms",
          description: "this is what included typograms code could look like",
          section: "Posts",
          handler: () => {
            window.location.href = "/blog/2024/typograms/";
          },
        },
        {
          id: "post-a-post-that-can-be-cited",
          title: "a post that can be cited",
          description: "this is what a post that can be cited looks like",
          section: "Posts",
          handler: () => {
            window.location.href = "/blog/2024/post-citation/";
          },
        },
        {
          id: "post-a-post-with-pseudo-code",
          title: "a post with pseudo code",
          description: "this is what included pseudo code could look like",
          section: "Posts",
          handler: () => {
            window.location.href = "/blog/2024/pseudocode/";
          },
        },
        {
          id: "post-a-post-with-code-diff",
          title: "a post with code diff",
          description: "this is how you can display code diffs",
          section: "Posts",
          handler: () => {
            window.location.href = "/blog/2024/code-diff/";
          },
        },
        {
          id: "post-a-post-with-advanced-image-components",
          title: "a post with advanced image components",
          description: "this is what advanced image components could look like",
          section: "Posts",
          handler: () => {
            window.location.href = "/blog/2024/advanced-images/";
          },
        },
        {
          id: "post-a-post-with-vega-lite",
          title: "a post with vega lite",
          description: "this is what included vega lite code could look like",
          section: "Posts",
          handler: () => {
            window.location.href = "/blog/2024/vega-lite/";
          },
        },
        {
          id: "post-a-post-with-geojson",
          title: "a post with geojson",
          description: "this is what included geojson code could look like",
          section: "Posts",
          handler: () => {
            window.location.href = "/blog/2024/geojson-map/";
          },
        },
        {
          id: "post-a-post-with-echarts",
          title: "a post with echarts",
          description: "this is what included echarts code could look like",
          section: "Posts",
          handler: () => {
            window.location.href = "/blog/2024/echarts/";
          },
        },
        {
          id: "post-a-post-with-chart-js",
          title: "a post with chart.js",
          description: "this is what included chart.js code could look like",
          section: "Posts",
          handler: () => {
            window.location.href = "/blog/2024/chartjs/";
          },
        },
        {
          id: "post-a-post-with-tikzjax",
          title: "a post with TikZJax",
          description: "this is what included TikZ code could look like",
          section: "Posts",
          handler: () => {
            window.location.href = "/blog/2023/tikzjax/";
          },
        },
        {
          id: "post-a-post-with-bibliography",
          title: "a post with bibliography",
          description: "an example of a blog post with bibliography",
          section: "Posts",
          handler: () => {
            window.location.href = "/blog/2023/post-bibliography/";
          },
        },
        {
          id: "post-a-post-with-jupyter-notebook",
          title: "a post with jupyter notebook",
          description: "an example of a blog post with jupyter notebook",
          section: "Posts",
          handler: () => {
            window.location.href = "/blog/2023/jupyter-notebook/";
          },
        },
        {
          id: "post-a-post-with-custom-blockquotes",
          title: "a post with custom blockquotes",
          description: "an example of a blog post with custom blockquotes",
          section: "Posts",
          handler: () => {
            window.location.href = "/blog/2023/custom-blockquotes/";
          },
        },
        {
          id: "post-a-post-with-table-of-contents-on-a-sidebar",
          title: "a post with table of contents on a sidebar",
          description:
            "an example of a blog post with table of contents on a sidebar",
          section: "Posts",
          handler: () => {
            window.location.href = "/blog/2023/sidebar-table-of-contents/";
          },
        },
        {
          id: "post-a-post-with-audios",
          title: "a post with audios",
          description: "this is what included audios could look like",
          section: "Posts",
          handler: () => {
            window.location.href = "/blog/2023/audios/";
          },
        },
        {
          id: "post-a-post-with-videos",
          title: "a post with videos",
          description: "this is what included videos could look like",
          section: "Posts",
          handler: () => {
            window.location.href = "/blog/2023/videos/";
          },
        },
        {
          id: "post-displaying-beautiful-tables-with-bootstrap-tables",
          title: "displaying beautiful tables with Bootstrap Tables",
          description: "an example of how to use Bootstrap Tables",
          section: "Posts",
          handler: () => {
            window.location.href = "/blog/2023/tables/";
          },
        },
        {
          id: "post-a-post-with-table-of-contents",
          title: "a post with table of contents",
          description: "an example of a blog post with table of contents",
          section: "Posts",
          handler: () => {
            window.location.href = "/blog/2023/table-of-contents/";
          },
        },
        {
          id: "post-a-post-with-giscus-comments",
          title: "a post with giscus comments",
          description: "an example of a blog post with giscus comments",
          section: "Posts",
          handler: () => {
            window.location.href = "/blog/2022/giscus-comments/";
          },
        },
        {
          id: "post-displaying-external-posts-on-your-al-folio-blog",
          title:
            'Displaying External Posts on Your al-folio Blog <svg width="1.2rem" height="1.2rem" top=".5rem" viewbox="0 0 40 40" xmlns="http://www.w3.org/2000/svg"><path d="M17 13.5v6H5v-12h6m3-3h6v6m0-6-9 9" class="icon_svg-stroke" stroke="#999" stroke-width="1.5" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg>',
          description: "",
          section: "Posts",
          handler: () => {
            window.open(
              "https://medium.com/@al-folio/displaying-external-posts-on-your-al-folio-blog-b60a1d241a0a?source=rss-17feae71c3c4------2",
              "_blank"
            );
          },
        },
        {
          id: "post-a-post-with-redirect",
          title: "a post with redirect",
          description: "you can also redirect to assets like pdf",
          section: "Posts",
          handler: () => {
            window.location.href = "/assets/pdf/example_pdf.pdf";
          },
        },
        {
          id: "post-a-post-with-diagrams",
          title: "a post with diagrams",
          description: "an example of a blog post with diagrams",
          section: "Posts",
          handler: () => {
            window.location.href = "/blog/2021/diagrams/";
          },
        },
        {
          id: "post-a-distill-style-blog-post",
          title: "a distill-style blog post",
          description:
            "an example of a distill-style blog post and main elements",
          section: "Posts",
          handler: () => {
            window.location.href = "/blog/2021/distill/";
          },
        },
        {
          id: "post-a-post-with-twitter",
          title: "a post with twitter",
          description: "an example of a blog post with twitter",
          section: "Posts",
          handler: () => {
            window.location.href = "/blog/2020/twitter/";
          },
        },
        {
          id: "post-a-post-with-disqus-comments",
          title: "a post with disqus comments",
          description: "an example of a blog post with disqus comments",
          section: "Posts",
          handler: () => {
            window.location.href = "/blog/2015/disqus-comments/";
          },
        },
        {
          id: "post-a-post-with-math",
          title: "a post with math",
          description: "an example of a blog post with some math",
          section: "Posts",
          handler: () => {
            window.location.href = "/blog/2015/math/";
          },
        },
        {
          id: "post-a-post-with-code",
          title: "a post with code",
          description: "an example of a blog post with some code",
          section: "Posts",
          handler: () => {
            window.location.href = "/blog/2015/code/";
          },
        },
        {
          id: "post-a-post-with-images",
          title: "a post with images",
          description: "this is what included images could look like",
          section: "Posts",
          handler: () => {
            window.location.href = "/blog/2015/images/";
          },
        },
        {
          id: "post-a-post-with-formatting-and-links",
          title: "a post with formatting and links",
          description: "march & april, looking forward to summer",
          section: "Posts",
          handler: () => {
            window.location.href = "/blog/2015/formatting-and-links/";
          },
        },
        {
          id: "news-a-simple-inline-announcement",
          title: "A simple inline announcement.",
          description: "",
          section: "News",
        },
        {
          id: "news-a-long-announcement-with-details",
          title: "A long announcement with details",
          description: "",
          section: "News",
          handler: () => {
            window.location.href = "/news/announcement_2/";
          },
        },
        {
          id: "news-a-simple-inline-announcement-with-markdown-emoji-sparkles-smile",
          title:
            'A simple inline announcement with Markdown emoji! <img class="emoji" title=":sparkles:" alt=":sparkles:" src="https://github.githubassets.com/images/icons/emoji/unicode/2728.png" height="20" width="20"> <img class="emoji" title=":smile:" alt=":smile:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f604.png" height="20" width="20">',
          description: "",
          section: "News",
        },
        {
          id: "projects-project-1",
          title: "project 1",
          description: "with background image",
          section: "Projects",
          handler: () => {
            window.location.href = "/projects/1_project/";
          },
        },
        {
          id: "projects-project-2",
          title: "project 2",
          description: "a project with a background image and giscus comments",
          section: "Projects",
          handler: () => {
            window.location.href = "/projects/2_project/";
          },
        },
        {
          id: "projects-project-3-with-very-long-name",
          title: "project 3 with very long name",
          description: "a project that redirects to another website",
          section: "Projects",
          handler: () => {
            window.location.href = "/projects/3_project/";
          },
        },
        {
          id: "projects-project-4",
          title: "project 4",
          description: "another without an image",
          section: "Projects",
          handler: () => {
            window.location.href = "/projects/4_project/";
          },
        },
        {
          id: "projects-project-5",
          title: "project 5",
          description: "a project with a background image",
          section: "Projects",
          handler: () => {
            window.location.href = "/projects/5_project/";
          },
        },
        {
          id: "projects-project-6",
          title: "project 6",
          description: "a project with no image",
          section: "Projects",
          handler: () => {
            window.location.href = "/projects/6_project/";
          },
        },
        {
          id: "projects-project-7",
          title: "project 7",
          description: "with background image",
          section: "Projects",
          handler: () => {
            window.location.href = "/projects/7_project/";
          },
        },
        {
          id: "projects-project-8",
          title: "project 8",
          description:
            "an other project with a background image and giscus comments",
          section: "Projects",
          handler: () => {
            window.location.href = "/projects/8_project/";
          },
        },
        {
          id: "projects-project-9",
          title: "project 9",
          description: "another project with an image \ud83c\udf89",
          section: "Projects",
          handler: () => {
            window.location.href = "/projects/9_project/";
          },
        },
        {
          id: "socials-email",
          title: "Send email",
          section: "Socials",
          handler: () => {
            window.open(
              "mailto:%69%73%69%73%74%69%63%6B%7A@%67%6D%61%69%6C.%63%6F%6D",
              "_blank"
            );
          },
        },
        {
          id: "socials-google-scholar",
          title: "Google Scholar",
          section: "Socials",
          handler: () => {
            window.open(
              "https://scholar.google.com/citations?user=qc6CJjYAAAAJ",
              "_blank"
            );
          },
        },
        {
          id: "socials-rss",
          title: "RSS Feed",
          section: "Socials",
          handler: () => {
            window.open("/feed.xml", "_blank");
          },
        },
        {
          id: "light-theme",
          title: "Change theme to light",
          description: "Change the theme of the site to Light",
          section: "Theme",
          handler: () => {
            setThemeSetting("light");
          },
        },
        {
          id: "dark-theme",
          title: "Change theme to dark",
          description: "Change the theme of the site to Dark",
          section: "Theme",
          handler: () => {
            setThemeSetting("dark");
          },
        },
        {
          id: "system-theme",
          title: "Use system default theme",
          description: "Change the theme of the site to System Default",
          section: "Theme",
          handler: () => {
            setThemeSetting("system");
          },
        },
      ];
    </script>
    <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script>
  </body>
</html>
